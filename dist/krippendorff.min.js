"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var math=_interopRequireWildcard(require("mathjs"));function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};a.get||a.set?Object.defineProperty(e,r,a):e[r]=t[r]}return e.default=t,e}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var DATATYPE={categorical:1,ordinal:2,interval:3,ratio:4};Object.freeze(DATATYPE);var Krippendorff=function(){function a(t,e){_classCallCheck(this,a),this._dataType=DATATYPE[e],e||(this._dataType=DATATYPE.categorical);var r=this._removeEmptyItem(t);this._ratingValues=this._getUniqueRatingValues(r),this._agreementTable=this._getAgreementTable(r,this._ratingValues),this._n=this._agreementTable.length,this._q=this._agreementTable[0].length,this._weightMatrix=this._getWeightMatrix(this._ratingValues,this._dataType),this._weightAgreementMatrix=this._getWeightedAgreementMatrix(this._agreementTable,this._weightMatrix),this._rArray=this._getArrayOfR(this._agreementTable),this._rMean=this._arraySum(this._rArray)/this._n,this._pArray=this._getArrayOfP(this._agreementTable,this._weightAgreementMatrix),this._epsilon=1/(this._n*this._rMean),this._piArray=this._getArrayOfPi(this._agreementTable,this._epsilon),this._pa=this._getPa(this._pArray,this._epsilon),this._pe=this._getPe(this._piArray,this._weightMatrix),this._KrAlpha=(this._pa-this._pe)/(1-this._pe)}return _createClass(a,[{key:"_getPe",value:function(t,e){var r=math.matrix([t]),a=math.multiply(math.transpose(r),r);return math.sum(math.dotMultiply(a,e))}},{key:"_getPa",value:function(t,e){return this._arrayAverage(t)*(1-e)+e}},{key:"_getArrayOfPi",value:function(t,e){var r=this,a=math.matrix(t),i=math.transpose(a)._data,n=[];return i.forEach(function(t){n.push(r._arraySum(t)*e)}),n}},{key:"_getArrayOfP",value:function(t,e){var r,a=[];for(r=0;r<this._n;r++){var i=t[r],n=e._data[r].map(function(t){return t-1}),u=math.sum(math.dotMultiply(i,n)),s=this._rMean*(this._rArray[r]-1);a.push(u/s)}return a}},{key:"_getArrayOfR",value:function(t){var e=this,r=[];return t.forEach(function(t){r.push(e._arraySum(t))}),r}},{key:"_getWeightedAgreementMatrix",value:function(t,e){return math.multiply(t,e)}},{key:"_getAgreementTable",value:function(t,e){var i=[];return t.forEach(function(r){var a=[];e.forEach(function(e){var t=r.filter(function(t){return t===e}).length;a.push(t)}),i.push(a)}),i}},{key:"_getWeightMatrix",value:function(t,e){var r,a,i=[],n=t.length;for(r=0;r<n;r++){var u=[];for(a=0;a<n;a++)u.push(this._calculateWeight(t,r,a,e));i.push(u)}return math.matrix(i)}},{key:"_calculateWeight",value:function(t,e,r,a){switch(a){case DATATYPE.ordinal:return r===e?1:1-math.combinations(math.abs(t[r]-t[e])+1,2)/math.combinations(this._q,2);case DATATYPE.interval:var i=Math.min.apply(Math,_toConsumableArray(t)),n=Math.max.apply(Math,_toConsumableArray(t));return 1-math.pow((t[r]-t[e])/(n-i),2);case DATATYPE.ratio:return 1-math.pow((t[r]-t[e])/(Number(t[r])+Number(t[e])),2);default:return t[e]===t[r]?1:0}}},{key:"_removeEmptyItem",value:function(t){var e=this;return t.filter(function(t){return!e._isEmptyItem(t)})}},{key:"_isEmptyItem",value:function(t){var e=this;return t.filter(function(t){return!e._isEmptyItemValue(t)}).length<2}},{key:"_isEmptyItemValue",value:function(t){return""===t||"#"===t}},{key:"_arraySum",value:function(t){return t.reduce(function(t,e){return t+e},0)}},{key:"_arrayAverage",value:function(t){return this._arraySum(t)/t.length}},{key:"_getUniqueRatingValues",value:function(t){var e=this,r=[];t.forEach(function(t){return r=r.concat(t)});var a=_toConsumableArray(new Set(r));return(a=a.filter(function(t){return!e._isEmptyItemValue(t)})).sort()}}]),a}();exports.default=Krippendorff;